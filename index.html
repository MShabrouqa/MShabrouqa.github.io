<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MShabrouqa Server</title>
<style>
    body {
        text-align: center;
    }

    .led-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* Three columns */
        gap: 10px;
        justify-content: center;
    }

    .led-button {
        color: white;
        font-weight: bold;
        /*width: 100px; /* Fixed width */
        /*height: 50px; /* Fixed height */
        padding: 10px;
        box-sizing: border-box;
    }

    #value {
        display: none; /* Hide the value paragraph */
    }
</style>
<script>
function checkLink() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4) {
            if (this.status == 200) {
                if (this.responseText === "true") {
                    document.getElementById("result").innerText = "Device is connected.";
                } else {
                    document.getElementById("result").innerText = "Device is not connected.";
                }
            } else {
                document.getElementById("result").innerText = "Error: Unable to connect to the device.";
            }
        }
    };
    xhttp.open("GET", "https://sgp1.blynk.cloud/external/api/isHardwareConnected?token=N5Ra0zsS6__J5zkjuf0pljWaBH0ZGb10", true);
    xhttp.send();
}

function displayValue() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            if (this.responseText !== "0" && this.responseText !== "1") {
                document.getElementById("value").innerText = "Value: " + this.responseText;

                // Iterate through each character in the response text
                for (var i = 0; i < this.responseText.length; i++) {
                    var digit = this.responseText.charAt(i);
                    var buttonId = "led" + (i + 1); // ID of the LED button
                    var button = document.getElementById(buttonId);

                    // Set background color based on digit value
                    if (digit === "0") {
                        button.style.backgroundColor = "green";
                    } else if (digit === "1") {
                        button.style.backgroundColor = "red";
                    } else {
                        button.style.backgroundColor = ""; // Reset color if neither 0 nor 1
                    }
                }
            }
        }
    };
    xhttp.open("GET", "https://sgp1.blynk.cloud/external/api/get?token=N5Ra0zsS6__J5zkjuf0pljWaBH0ZGb10&v2", true);
    xhttp.send();
}

function updateValue(value) {
    var xhttp = new XMLHttpRequest();
    xhttp.open("GET", "https://sgp1.blynk.cloud/external/api/update?token=N5Ra0zsS6__J5zkjuf0pljWaBH0ZGb10&v1=" + value, true);
    xhttp.send();
}
</script>
</head>
<body>
    <h1>ESP Web Server</h1>
    <p id="result"></p>
    <div class="led-container">
        <button id="led1" class="led-button" onclick="updateValue(1)">LED 1</button>
        <button id="led2" class="led-button" onclick="updateValue(2)">LED 2</button>
        <button id="led3" class="led-button" onclick="updateValue(3)">LED 3</button>
        <button id="led4" class="led-button" onclick="updateValue(4)">LED 4</button>
        <button id="led5" class="led-button" onclick="updateValue(5)">LED 5</button>
        <button id="led6" class="led-button" onclick="updateValue(6)">LED 6</button>
        <button id="led7" class="led-button" onclick="updateValue(7)">LED 7</button>
        <button id="led8" class="led-button" onclick="updateValue(8)">LED 8</button>
    </div>
    <p id="value"></p>
    <!-- Call checkLink function every 100 milliseconds -->
    <script>
        setInterval(checkLink, 100);
    </script>

    <!-- Call displayValue function every 100 milliseconds -->
    <script>
        setInterval(displayValue, 100);
    </script>
</body>
</html>
